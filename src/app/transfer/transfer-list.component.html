<div class="card mb-3">
  <div class="card-body d-flex justify-content-between align-items-center">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb m-0 p-0">
        <li class="breadcrumb-item active"><a>Transfer List</a></li>
      </ol>
    </nav>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <div class="mb-3 d-flex gap-2 align-items-center">
      <select (change)="load()" class="form-select form-select-sm w-auto">
        <option value="">All statuses</option>
        <option value="in_transfer">In Transfer</option>
        <option value="transfer_accepted">Transfer Accepted</option>
        <option value="returning">Returning</option>
        <option value="return_accepted">Return Accepted</option>
      </select>
      <button class="btn btn-outline-secondary btn-sm" (click)="load()">Refresh</button>
    </div>

    <!-- Desktop Table View -->
    <div class="table-responsive d-none d-md-block">
      <table class="table table-sm table-hover">
        <thead>
          <tr>
            <th>ID</th>
            <th>From → To</th>
            <th>Item</th>
            <th>Qty</th>
            <th>Status</th>
            <th>Created</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let t of transfers">
            <td>{{ t.transferId }}</td>
            <td>{{ t.fromRoom.roomName }} → {{ t.toRoom.roomName }}</td>
            <td>
              {{ t.itemType }}<span *ngIf="t.itemId"> #{{ t.itemId }}</span>
            </td>
            <td>{{ t.quantity }}</td>
            <td><span class="badge bg-secondary text-light">{{ t.status }}</span></td>
            <td>{{ t.createdAt | date:'short' }}</td>
            <td>
              <button class="btn btn-sm btn-outline-primary me-1" (click)="view(t)">View</button>
              <button *ngIf="canAccept(t)" class="btn btn-sm btn-success" (click)="accept(t)">Accept</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Mobile Card List View -->
    <div class="mobile-list-view d-md-none">
      <div *ngFor="let t of transfers" class="mobile-card mb-3">
        <div class="d-flex align-items-center mb-3 pb-2 border-bottom">
          <div class="fw-bold text-primary">#{{ t.transferId }}</div>
          <div class="ms-auto">
            <span class="badge bg-secondary text-light">{{ t.status }}</span>
          </div>
        </div>

        <div class="mobile-card-row">
          <span class="label">Transfer Route</span>
          <span class="value">{{ t.fromRoom.roomName }} → {{ t.toRoom.roomName }}</span>
        </div>

        <div class="mobile-card-row">
          <span class="label">Item</span>
          <span class="value">{{ t.itemType }}<span *ngIf="t.itemId"> #{{ t.itemId }}</span></span>
        </div>

        <div class="mobile-card-row">
          <span class="label">Quantity</span>
          <span class="value">{{ t.quantity }}</span>
        </div>

        <div class="mobile-card-row">
          <span class="label">Date</span>
          <div class="value small text-muted">{{ t.createdAt | date:'short' }}</div>
        </div>

        <div class="mt-3 pt-2 border-top d-grid gap-2 d-flex justify-content-end">
          <button class="btn btn-sm btn-outline-primary flex-grow-1" (click)="view(t)">View</button>
          <button *ngIf="canAccept(t)" class="btn btn-sm btn-success flex-grow-1" (click)="accept(t)">Accept</button>
        </div>
      </div>

      <div *ngIf="!transfers || transfers.length === 0" class="text-center py-5 text-muted">
        No transfers yet.
      </div>
    </div>

    <div class="d-flex justify-content-between align-items-center mt-3" *ngIf="totalPages > 1 && !loading">
      <div class="text-muted">
        Showing {{ (page - 1) * limit + 1 }} to {{ (page * limit) > total ? total : (page * limit) }} of {{ total }}
        transfers
      </div>
      <nav aria-label="Page navigation">
        <ul class="pagination mb-0">
          <li class="page-item" [class.disabled]="page === 1">
            <button class="page-link" (click)="onPageChange(page - 1)">Previous</button>
          </li>
          <li class="page-item" *ngFor="let p of range(1, totalPages)" [class.active]="page === p">
            <button class="page-link" (click)="onPageChange(p)">{{ p }}</button>
          </li>
          <li class="page-item" [class.disabled]="page === totalPages">
            <button class="page-link" (click)="onPageChange(page + 1)">Next</button>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>