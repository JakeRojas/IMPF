<!-- src/app/stock-request/stock-request-list.component.html -->
<!-- <div class="p-3 container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Stock Requests</h3>
    <div>
      <button class="btn btn-sm btn-success" (click)="create()">New Request</button>
    </div>
  </div>

  <table class="table table-sm">
    <thead>
      <tr>
        <th>ID</th>
        <th>Room</th>
        <th>Requester</th>
        <th>Item Type</th>
        <th>Qty</th>
        <th>Date</th>
        <th>Status</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let r of requests">
        <td>{{ r.stockRequestId || r.id }}</td>
        <td>{{ r.requesterRoomId }}</td>
        <td>{{ r.acccountId || r.accountId }}</td>
        <td>{{ r.itemType }}</td>
        <td>{{ r.quantity }}</td>
        <td>{{ r.createdAt || r.created_at || r.updatedAt }}</td>
        <td>{{ r.status }}</td>
        <td>
          <button class="btn btn-sm btn-outline-primary" (click)="view(r)">View</button>

          <button *ngIf="isAdmin() && r.status === 'pending'" class="btn btn-sm btn-success ms-1" (click)="approve(r)">Approve</button>
          <button *ngIf="isAdmin() && r.status === 'pending'" class="btn btn-sm btn-warning ms-1" (click)="disapprove(r)">Disapprove</button>

          <button *ngIf="isStockroom() && r.status === 'approved'" class="btn btn-sm btn-danger ms-1" (click)="fulfill(r)">Fulfill</button>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="loading" class="text-center">
    <span class="spinner-border spinner-border-sm"></span>
  </div>
</div> -->

<div class="p-3 container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Stock Requests</h3>
    <div>
      <button class="btn btn-sm btn-success" (click)="create()">New Request</button>
    </div>
  </div>

  <table class="table table-sm">
    <thead>
      <tr>
        <th>ID</th>
        <th>Room</th>
        <th>Requester</th>
        <th>Item</th>
        <th>Qty</th>
        <th>Date</th>
        <th>Status</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let r of requests">
        <td>{{ r.stockRequestId || r.id }}</td>
        <td>{{ r.requesterRoomId }}</td>
        <td>{{ r.acccountId }}</td>
        <td>
          <!-- show either requestedItem summary (if present) or raw itemType/itemId -->
          <ng-container *ngIf="r.requestedItem; else rawItem">
            <ng-container *ngIf="r.requestedItem.kind === 'inventory'">
              {{ r.requestedItem.type }} â€” {{ r.requestedItem.inventory?.apparelName || r.requestedItem.inventory?.supplyName || r.requestedItem.inventory?.genItemName || ('#' + (r.itemId || '')) }}
            </ng-container>
            <ng-container *ngIf="r.requestedItem.kind === 'unit'">
              {{ r.requestedItem.type }} (unit #{{ r.requestedItem.unit?.id || r.itemId }})
            </ng-container>
            <ng-container *ngIf="r.requestedItem.kind === 'unknown'">
              {{ r.itemType }} #{{ r.itemId }}
            </ng-container>
          </ng-container>
          <ng-template #rawItem>
            {{ r.itemType }} #{{ r.itemId }}
          </ng-template>
        </td>
        <td>{{ r.quantity }}</td>
        <td>{{ r.createdAt | date: 'short' }}</td>
        <td>{{ r.status }}</td>
        <td>
          <button class="btn btn-sm btn-outline-primary" (click)="view(r)">View</button>
          <button *ngIf="isAdmin() && r.status === 'pending'" class="btn btn-sm btn-success ms-1" (click)="approve(r)">Approve</button>
          <button *ngIf="isAdmin() && r.status === 'pending'" class="btn btn-sm btn-warning ms-1" (click)="disapprove(r)">Disapprove</button>
          <button *ngIf="isStockroom() && r.status === 'approved'" class="btn btn-sm btn-danger ms-1" (click)="fulfill(r)">Fulfill</button>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="loading" class="text-center"><span class="spinner-border spinner-border-sm"></span></div>
</div>
