<div class="app-container d-flex flex-column">
  <!-- Mobile Header (Only visible on small screens) -->
  <header *ngIf="account" class="navbar navbar-expand-md navbar-dark bg-dark d-md-none px-3 sticky-top">
    <button class="navbar-toggler d-block" type="button" (click)="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a routerLink="/" class="navbar-brand ms-2">
      <img src="assets/gsc-gsu-logo-header.png" alt="Logo" height="30">
    </a>
    <div class="ms-auto">
      <button (click)="logout()" class="btn btn-outline-light btn-sm">Logout</button>
    </div>
  </header>

  <div class="d-flex flex-grow-1 position-relative">
    <!-- Overlay for mobile sidebar -->
    <div class="sidebar-overlay" [class.show]="isSidebarVisible" (click)="toggleSidebar()"></div>

    <!-- SIDEBAR (LEFT COLUMN) -->
    <aside *ngIf="account" 
           class="sidebar col-md-2 bg-white border-end d-flex flex-column p-3 h-100 position-sticky top-0"
           [class.show]="isSidebarVisible">
      
      <!-- Logo (Desktop only) -->
      <div class="mb-4 text-center d-none d-md-block">
        <a routerLink="/" class="d-inline-block">
          <img src="assets/gsc-gsu-logo-header.png" alt="Logo" class="img-fluid" style="max-height: 55px;">
        </a>
      </div>

      <!-- Navigation Links -->
      <nav class="nav nav-pills flex-column mb-auto">
        <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="nav-link">
          <i class="bi bi-house-door me-2"></i>Home
        </a>

        <a routerLink="/profile" routerLinkActive="active" class="nav-link">
          <i class="bi bi-person me-2"></i>Profile
        </a>

        <a *ngIf="account.role" routerLink="/room" routerLinkActive="active" class="nav-link">
          <i class="bi bi-door-open me-2"></i>Room
        </a>

        <a *ngIf="account.role === Role.SuperAdmin || account.role === Role.Admin || account.role === Role.StockroomAdmin" 
           routerLink="/scan" routerLinkActive="active" class="nav-link">
          <i class="bi bi-qr-code-scan me-2"></i>Scan
        </a>

        <a *ngIf="account.role === Role.SuperAdmin" routerLink="/admin" routerLinkActive="active" class="nav-link">
          <i class="bi bi-shield-lock me-2"></i>Admin
        </a>

        <a *ngIf="account.role === Role.SuperAdmin || account.role === Role.Admin || account.role === Role.StockroomAdmin"
           routerLink="/req-stock" routerLinkActive="active" class="nav-link">
          <i class="bi bi-box-seam me-2"></i>Stock Requests
        </a>

        <a *ngIf="account.role === Role.SuperAdmin || account.role === Role.StockroomAdmin || account.role === Role.Teacher"
           routerLink="/req-item" routerLinkActive="active" class="nav-link">
          <i class="bi bi-clipboard-check me-2"></i>Item Request
        </a>

        <a class="nav-link" routerLink="/transfers" routerLinkActive="active">
          <i class="bi bi-arrow-left-right me-2"></i>Transfers
        </a>

        <a class="nav-link" routerLink="/borrow" routerLinkActive="active">
          <i class="bi bi-hand-index-thumb me-2"></i>Borrow
        </a>
      </nav>

      <!-- Desktop Logout (Bottom of sidebar) -->
      <div class="mt-4 pt-4 border-top d-none d-md-block">
        <button (click)="logout()" class="btn btn-outline-danger w-100 d-flex align-items-center justify-content-center">
          <i class="bi bi-box-arrow-right me-2"></i>Logout
        </button>
      </div>
    </aside>

    <!-- CONTENT (RIGHT COLUMN) -->
    <main class="main-content d-flex flex-column" [class.w-100]="!account">
      
      <!-- Top Bar (Desktop only) -->
      <div *ngIf="account" class="d-none d-md-flex align-items-center justify-content-between bg-white border-bottom p-2 px-4 shadow-sm">
        <div class="d-flex align-items-center">
          <router-outlet name="subnav"></router-outlet>
        </div>
        
        <div class="text-muted small">
          Logged in as: <span class="fw-bold text-dark">{{account.firstName}} {{account.lastName}}</span>
        </div>
      </div>

      <!-- Main Content Area -->
      <div class="flex-grow-1 p-3 p-md-4 overflow-auto">
        <alert></alert>
        <router-outlet></router-outlet>
      </div>
    </main>
  </div>
</div>